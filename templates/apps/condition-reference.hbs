<div class="condition-reference-wrapper">
  {{!-- Dialog Header --}}
  <div class="editor-header">
    <h2 class="editor-title">{{localize "AOA.Condition.Reference"}}</h2>
    {{#if hasTarget}}
    <p class="editor-subtitle">
      <i class="fas fa-crosshairs"></i>
      {{localize "AOA.Condition.TargetActor"}}: <strong>{{targetName}}</strong>
    </p>
    {{else}}
    <p class="editor-subtitle">{{localize "AOA.Condition.ReferenceSubtitle"}}</p>
    {{/if}}
  </div>

  {{!-- Conditions List --}}
  <div class="condition-reference-content">
    <div class="conditions-list">
      {{#each conditions}}
      <div class="condition-entry" data-condition-id="{{id}}">
        <div class="condition-header" data-action="toggleDetails">
          {{!-- Top row: icon, name, controls --}}
          <div class="condition-top-row">
            <img src="{{icon}}" class="condition-icon" alt="{{label}}" width="36" height="36"/>
            <div class="condition-title">
              <h4 class="condition-name">{{label}}</h4>
            </div>
            {{#if hasDetails}}
            <i class="fas fa-chevron-down toggle-icon"></i>
            {{/if}}
            {{#if ../hasTarget}}
            <button type="button" class="apply-btn" data-action="applyCondition" data-condition-id="{{id}}" title="{{localize 'AOA.Condition.ApplyToTarget'}}">
              <i class="fas fa-plus"></i>
            </button>
            {{/if}}
          </div>
          {{!-- Description below the header row --}}
          <p class="condition-description">{{description}}</p>
        </div>

        {{#if hasDetails}}
        <div class="condition-details collapsed">
          {{#if modifiers.length}}
          <div class="detail-section modifiers">
            <h5>{{localize "AOA.Condition.Modifiers"}}</h5>
            <ul class="modifier-list">
              {{#each modifiers}}
              <li class="modifier {{#if isPositive}}positive{{/if}}{{#if isNegative}}negative{{/if}}">
                <span class="modifier-label">{{label}}</span>
                <span class="modifier-value">{{value}}</span>
              </li>
              {{/each}}
            </ul>
          </div>
          {{/if}}

          {{#if flags.length}}
          <div class="detail-section flags">
            <h5>{{localize "AOA.Condition.SpecialEffects"}}</h5>
            <ul class="flag-list">
              {{#each flags}}
              <li class="flag">
                <i class="fas fa-exclamation-circle"></i>
                <span>{{this}}</span>
              </li>
              {{/each}}
            </ul>
          </div>
          {{/if}}

          {{#if effects.length}}
          <div class="detail-section effects">
            <h5>{{localize "AOA.Condition.SystemEffects"}}</h5>
            <ul class="effect-list">
              {{#each effects}}
              <li class="effect">
                <i class="fas fa-cog"></i>
                <span>{{this}}</span>
              </li>
              {{/each}}
            </ul>
          </div>
          {{/if}}
        </div>
        {{/if}}
      </div>
      {{/each}}
    </div>
  </div>
</div>
