<div class="wor">
  <div class="attack-card {{#if isHit}}hit{{else}}miss{{/if}} {{#if isCritical}}critical{{/if}} {{degreeCss}}">
    {{!-- Header with Attacker Portrait (styled like Defense Card) --}}
    <div class="card-header">
      {{#if attacker.img}}
      <img src="{{attacker.img}}" alt="{{attacker.name}}" class="actor-portrait" />
      {{/if}}
      <div class="header-info">
        <h3 class="attack-roll-title">{{localize "AOA.Combat.AttackRoll"}}</h3>
        <span class="actor-name">{{attacker.name}}</span>
      </div>
    </div>

  {{!-- Result Indicator (styled like Defense Card) --}}
  <div class="result-indicator {{degreeCss}}">
    <div class="result-display attack-result">
      <span class="dice-pool">{{pool.total}}d6</span>
      <span class="result-arrow">→</span>
      <span class="hits-count">{{roll.hits}} {{localize "AOA.Roll.Hits"}}</span>
    </div>
  </div>

  {{!-- Weapon Item Display --}}
  <div class="item-display">
    {{#if weapon.img}}
    <img src="{{weapon.img}}" alt="{{weapon.name}}" class="item-image" />
    {{/if}}
    <div class="item-info">
      <h5 class="item-name weapon-name">{{weapon.name}}</h5>
      <span class="item-details">
        {{localize (concat "AOA.Weapon.RangeType." (capitalize weapon.range))}}
      </span>
    </div>
  </div>

  {{!-- Damage Section (styled like result indicator) --}}
  {{#if damage}}
  <div class="damage-section">
    <div class="section-header damage-header">
      <span class="section-title">{{localize "AOA.Combat.Damage"}}</span>
    </div>
    <div class="damage-result">
      <span class="dice-pool">{{damage.rawDamage}}d6</span>
      <span class="result-arrow">→</span>
      <span class="damage-hits">{{damage.traumaDealt}} {{localize "AOA.Roll.Hits"}}</span>
    </div>
  </div>
  {{/if}}

  {{!-- Miss Message --}}
  {{#unless isHit}}
  <div class="attack-miss">
    <i class="fas fa-shield"></i>
    <span class="miss-message">{{localize "AOA.Combat.AttackMissed"}}</span>
  </div>
  {{/unless}}

  {{!-- Collapsible Details --}}
  <div class="collapsible-section" data-section="attack-details">
    <div class="collapsible-header collapsed" data-action="toggle-collapse">
      <i class="fas fa-chevron-down collapse-icon"></i>
      <span class="section-title">{{localize "AOA.Roll.Details"}}</span>
    </div>
    <div class="collapsible-content collapsed">
      {{!-- Target Info --}}
      {{#if target}}
      <div class="target-info">
        <span class="target-label">{{localize "AOA.Combat.Target"}}:</span>
        <span class="target-name">{{target.name}}</span>
        <span class="target-defense">({{localize "AOA.Defense.Label"}} {{target.defense}}, TT {{targetThreshold}})</span>
      </div>
      {{/if}}

      {{!-- Dice Display (D6 icons) --}}
      <div class="roll-dice">
        {{{diceDisplay}}}
      </div>

      {{!-- Damage Breakdown (on hit) --}}
      {{#if damage}}
      <div class="damage-breakdown">
        <div class="damage-row">
          <span class="damage-label">{{localize "AOA.Weapon.BaseDamage"}}</span>
          <span class="damage-value">{{damage.baseDamage}}</span>
        </div>
        {{#if damage.strengthBonus}}
        <div class="damage-row">
          <span class="damage-label">{{localize "AOA.Attribute.Str.long"}}</span>
          <span class="damage-value">+{{damage.strengthBonus}}</span>
        </div>
        {{/if}}
        {{#if damage.qualityBonus}}
        <div class="damage-row">
          <span class="damage-label">{{localize "AOA.Weapon.Quality"}}</span>
          <span class="damage-value">+{{damage.qualityBonus}}</span>
        </div>
        {{/if}}
        {{#if target.dr}}
        <div class="damage-row dr">
          <span class="damage-label">{{localize "AOA.Armor.DR.Label"}}</span>
          <span class="damage-value">-{{target.dr}}</span>
        </div>
        {{/if}}
        <div class="damage-row total">
          <span class="damage-label">{{localize "AOA.Combat.TotalDamage"}}</span>
          <span class="damage-value">{{damage.finalDamage}}</span>
        </div>
      </div>
      {{/if}}
    </div>
  </div>

  {{!-- Action Buttons (on hit) --}}
  {{#if isHit}}
  {{#if target}}
  <div class="chat-card-buttons">
    <button type="button" class="apply-damage" data-action="apply-damage" data-target-id="{{target.id}}" data-damage="{{damage.traumaDealt}}">
      <i class="fas fa-heart-crack"></i>
      <span>{{localize "AOA.Combat.ApplyDamage"}}</span>
    </button>
  </div>
  {{/if}}
  {{/if}}
  </div>
</div>
